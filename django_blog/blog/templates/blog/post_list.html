{% extends 'blog/base.html' %}
{% block title %}All Blog Posts{% endblock title %}

{% block content %}
<h1 class="mb-4">Latest Blog Posts</h1>

{% for post in posts %}
    <article class="card mb-4 shadow-sm">
        <div class="card-body">
            <h2 class="card-title">
                <a href="{% url 'post-detail' pk=post.pk %}" class="text-decoration-none text-primary">
                    {{ post.title }}
                </a>
            </h2>
            
            <p class="card-text text-muted small">
                Posted by <span class="fw-bold">{{ post.author.username }}</span> on {{ post.published_date|date:"F d, Y" }}
            </p>
            
            <p class="card-text">
                {{ post.content|truncatechars:200 }} 
                <a href="{% url 'post-detail' pk=post.pk %}" class="text-info small">Read More &rarr;</a>
            </p>
            
        </div>
        <span class="badge bg-secondary fs-6">
        Total Comments: {{ all_comments|length }}
    </span>{% if user.is_authenticated %}
    <div class="card p-4 mt-5 shadow">
        <h5>Leave a Comment:</h5>
        
        <form method="POST" action="{% url 'comment-create' pk=post.pk %}">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="{{ comment_form.content.id_for_label }}" class="form-label">{{ comment_form.content.label }}</label>
                {{ comment_form.content }}
                {% for error in comment_form.content.errors %}
                    <div class="invalid-feedback d-block">{{ error }}</div>
                {% endfor %}
            </div>
            
            <button type="submit" class="btn btn-primary">Submit Comment</button>
        </form>
    </div>
{% else %}
    <div class="alert alert-warning text-center mt-5">
        Please <a href="{% url 'login' %}">log in</a> to leave a comment.
    </div>
{% endif %}
    </article>
{% empty %}
    <div class="alert alert-info" role="alert">
        No blog posts have been published yet. Be the first!
    </div>
{% endfor %}

{% endblock content %}